<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="dsn.mypage">
  	<update id="userUpdate" parameterType="Map">
		update f_user set
  			u_nick=#{u_nick},
  			u_tel=#{u_tel},
  			u_email=#{u_email}
  			where u_idx=#{u_idx}
  		</update>
  	<update id="pwdUpdate" parameterType="Map">
  		UPDATE F_USER SET
  			U_PWD=#{pwdconfirm}
  			WHERE U_IDX=#{u_idx}
  	</update>
  	<select id="pwdFind" parameterType="Integer" resultType="String">
  		 SELECT U_PWD FROM F_USER WHERE U_IDX=#{u_idx}
  	</select>
  	<select id="dsn.mypage.totalCnt" parameterType="Integer" resultType="Integer">
  	SELECT COUNT(*) FROM F_CLIENT WHERE U_IDX=#{u_idx}
  	</select>
  	<select id="myPageList" parameterType="Map" resultType="dsn.contest.model.ConDTO">
			select * from
			(select * from
			(select rownum as rnum,a.* from
			(select * from f_client order by c_idx desc)a)b
			where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end})where u_idx=#{u_idx}
			
  	</select>
  	<select id="virtualWallet" parameterType="Map" resultType="dsn.virtualwallet.model.WalletDTO">
			select * from
			(select * from
			(select rownum as rnum,a.* from
			(select * from f_account order by a_idx desc)a)b
			where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end})where u_idx=#{u_idx}
  	</select>
  	<select id="getLastBalance" parameterType="Integer" resultType="Integer">
  		SELECT A_BALANCE FROM
			(SELECT A_BALANCE,U_IDX FROM
			(SELECT A_IDX,U_IDX,A_BALANCE FROM F_ACCOUNT ORDER BY A_IDX DESC)
			WHERE ROWNUM=1)
		WHERE U_IDX=#{u_idx}
  	</select>
  	<select id="userInfoFind" parameterType="Map" resultType="dsn.member.model.MemberDTO">
  		select * from f_user where u_idx=#{u_idx}
  	</select>
  	<insert id="payout" parameterType="Map">
  		insert into f_withdraw values(
  			w_idx.nextval,
  			#{u_idx},
  			#{w_bank},
  			#{w_name},
  			#{w_number},
  			#{w_price},
  			sysdate
  		)
  	</insert>
  	<select id="walletCnt" parameterType="Integer" resultType="Integer">
  	SELECT COUNT(*) FROM F_ACCOUNT WHERE U_IDX=#{u_idx}
  	</select>
  	<insert id="writeReview" parameterType="Map">
  		insert into f_review values(
  			rv_idx.nextval,
  			0,
  			16,
  			#{rv_content},
  			sysdate
  		)
  	</insert>
  	<select id="tradeFind" parameterType="Map" resultType="dsn.trade.model.TradeDTO">
  		select * from
			(select * from
			(select rownum as rnum,a.* from
			(select * from f_trade order by t_idx desc)a)b
			where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end})where u_idx=#{u_idx}
  	</select>
  	<select id="getTradeCnt" parameterType="Integer" resultType="Integer">
  		select count(*) from f_trade where u_idx=${u_idx}
  	</select>
  </mapper>