<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dsn.designer">
	<select id="portfolio" parameterType="Map" resultType="dsn.designer.model.DesignerDTO">
		select * from 
			(select rownum as rnum, a.* from
			(select * from f_designer order by d_idx desc)a)b
		where
			rnum <![CDATA[>=]]> #{start}
		and
			rnum <![CDATA[<=]]> #{end}
	</select>
	<select id="review" parameterType="Map" resultType="dsn.review.model.ReviewDTO">
  		select * from 
			(select rownum as rnum, a.* from
			(select * from f_review order by u_idx desc)a)b
		where
			rnum <![CDATA[>=]]> #{start}
		and
			rnum <![CDATA[<=]]> #{end}
  	</select>
	<select id="portfolioTotalCnt" resultType="Integer">
		select count(*) from f_designer
	</select>
	<select id="reviewTotalCnt" resultType="Integer">
		select count(*) from f_review
	</select>
	<select id="designerTotalCnt" resultType="Integer">
		select count(*) from f_user
	</select>
	<insert id="profileInsert" parameterType="dsn.profile.model.ProfileDTO">
		insert into
			f_profile
		values(
			p_idx.nextval,
			#{u_idx},
			#{p_img},
			#{p_info},
			#{u_wallet}
		)
	</insert>
	<update id="profileUpdate" parameterType="dsn.profile.model.ProfileDTO">
		update
			f_profile
		set
			p_img=#{p_img},
			p_info=#{p_info},
			u_wallet=#{u_wallet}
		where
			u_idx=#{u_idx}
	</update>
	<select id="designerWin" parameterType="Integer" resultType="Integer">
		select
			count(d_win)
		from
			f_designer
		where
			u_idx=#{u_idx}
	</select>
	<select id="profileInfo" parameterType="Integer" resultType="dsn.profile.model.ProfileDTO">
		select
			*
		from
			f_profile
		where
			u_idx=#{u_idx}
			
	</select>
	<select id="userInfo" parameterType="Integer" resultType="dsn.member.model.MemberDTO">
		select
			*
		from
			f_user
		where
			u_idx=#{u_idx}
	</select>
	<select id="designerList" resultType="Map">
		select * from
		    (select rownum as rnum, a.*from
		    (SELECT p.p_img, p.p_info, u.u_nick, u.u_email, u.u_idx
		   from f_profile p, f_user u, f_designer d
		   where p.u_idx = u.u_idx
		   and u.u_idx = d.u_idx
		   and u.u_type = 2 )a)b
		where
			rnum <![CDATA[>=]]> #{start}
		and
			rnum <![CDATA[<=]]> #{end}
	</select>
	<select id="designerListTotalCnt" resultType="Integer">
		select count(u_type) from f_user
		where u_type = 2
	</select>
	<select id="portfolioDetail" parameterType="Integer" resultType="dsn.designer.model.DesignerDTO">
		select d_name, c_cate, d_win, d_img_2, d_content
		from f_designer
		where d_idx = #{d_idx}
	<select id="designPhotos" parameterType="Map" resultType="dsn.designer.model.DesignerDTO">
		select * from
			(select rownum as rnum, a.*from
			(select d_img_1, u_idx from f_designer order by d_idx desc)a)b
		where
		    rnum <![CDATA[>=]]> 0
		and
			rnum <![CDATA[<=]]> 3
		and
			u_idx=#{u_idx}
	</select>
	<insert id="writeReview" parameterType="Map">
  		insert into f_review values(
  			rv_idx.nextval,
  			0,
  			16,
  			#{rv_content},
  			sysdate
  		)
  	</insert>
	<select id="designerListTotalCnt" resultType="Integer">
      select count(u_type) from f_user
      where u_type = 2
   </select>
   <select id="designerList" resultType="dsn.designer.model.ListDTO">
      select * from
          (select rownum as rnum, a.*from
          (SELECT p.p_img, p.p_info, u.u_nick, u.u_email, u.u_idx
         from f_profile p, f_user u, f_designer d
         where p.u_idx = u.u_idx
         and u.u_idx = d.u_idx
         and u.u_type = 2 )a)b
      where
         rnum <![CDATA[>=]]> #{start}
      and
         rnum <![CDATA[<=]]> #{end}
   </select>
</mapper>
